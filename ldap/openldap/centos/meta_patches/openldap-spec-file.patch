From 31cec68ea9c887b363dc31255fb96e88c67c4b63 Mon Sep 17 00:00:00 2001
From: Scott Little <scott.little@windriver.com>
Date: Mon, 2 Oct 2017 17:11:21 -0400
Subject: [PATCH] openldap-spec-file.patch

Signed-off-by: Dongqi Chen <chen.dq@neusoft.com>
Signed-off-by: Yong Fu <fuyong@neusoft.com>
---
 ldap/SPECS/openldap.spec | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/SPECS/openldap.spec b/SPECS/openldap.spec
index 61140f2..99e0db0 100644
--- a/SPECS/openldap.spec
+++ b/SPECS/openldap.spec
@@ -207,7 +207,7 @@ mv check_password.so check_password.so.%{check_password_version}
 ln -s check_password.so.%{check_password_version} %{buildroot}%{_libdir}/openldap/check_password.so
 install -m 755 check_password.so.%{check_password_version} %{buildroot}%{_libdir}/openldap/
 # install -m 644 README %{buildroot}%{_libdir}/openldap
-install -d -m 755 %{buildroot}%{_sysconfdir}/openldap
+install -d -m 740 %{buildroot}%{_sysconfdir}/openldap
 cat > %{buildroot}%{_sysconfdir}/openldap/check_password.conf <<EOF
 # OpenLDAP pwdChecker library configuration
 
@@ -322,6 +322,9 @@ exit 0
 
 
 %post servers
+
+mkdir -p /var/lib/openldap-data
+
 %systemd_post slapd.service
 
 # generate configuration if necessary
@@ -474,7 +477,7 @@ exit 0
 %{_mandir}/man5/slapd*.5*
 %{_mandir}/man5/slapo-*.5*
 # obsolete configuration
-%ghost %config(noreplace,missingok) %attr(0640,ldap,ldap) %{_sysconfdir}/openldap/slapd.conf
+#%ghost %config(noreplace,missingok) %attr(0640,ldap,ldap) %{_sysconfdir}/openldap/slapd.conf
 
 %files clients
 %{_bindir}/*
-- 
2.17.1

