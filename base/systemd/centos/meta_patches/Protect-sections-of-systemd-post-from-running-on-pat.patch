From eece9585b5f9258c7180247b1664e92b5ef83efe Mon Sep 17 00:00:00 2001
Message-Id: <eece9585b5f9258c7180247b1664e92b5ef83efe.1574265913.git.Jim.Somerville@windriver.com>
In-Reply-To: <eeb3e979288cb8c14d8546d12a27da4c88fbb0e4.1574265913.git.Jim.Somerville@windriver.com>
References: <eeb3e979288cb8c14d8546d12a27da4c88fbb0e4.1574265913.git.Jim.Somerville@windriver.com>
From: Scott Little <scott.little@windriver.com>
Date: Mon, 2 Oct 2017 17:53:00 -0400
Subject: [PATCH 2/3] Protect sections of systemd post from running on patch

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>
Signed-off-by: Long Li <lilong-neu@neusoft.com>
Signed-off-by: Yong Fu <fuyong@neusoft.com>
---
 SPECS/systemd.spec | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/SPECS/systemd.spec b/SPECS/systemd.spec
index fbb016f..34d7c59 100644
--- a/SPECS/systemd.spec
+++ b/SPECS/systemd.spec
@@ -794,6 +794,7 @@ function mod_nss() {
     fi
 }
 
+if [ 1 -eq 0 ] ; then # TIS: Skip this. We don't want myhostname in nsswitch.conf
 FILE="$(readlink /etc/nsswitch.conf || echo /etc/nsswitch.conf)"
 mod_nss "$FILE"
 
@@ -804,6 +805,7 @@ else
         # possible future authselect configuration
 	mod_nss "/etc/authselect/user-nsswitch.conf"
 fi
+fi
 
 # check if nobody or nfsnobody is defined
 export SYSTEMD_NSS_BYPASS_SYNTHETIC=1
-- 
2.17.1

