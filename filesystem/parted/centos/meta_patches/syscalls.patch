From 58d86a82323f838bb6169423fb3dd958bb92c147 Mon Sep 17 00:00:00 2001
From: Kristine Bujold <kristine.bujold@windriver.com>
Date: Wed, 21 Dec 2016 15:28:53 -0500
Subject: [PATCH 1/3] syscalls.patch

Signed-off-by: Dongqi Chen <chen.dq@neusoft.com>
---
 SPECS/parted.spec | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/SPECS/parted.spec b/SPECS/parted.spec
index 1f453cb..9316ebe 100644
--- a/SPECS/parted.spec
+++ b/SPECS/parted.spec
@@ -13,6 +13,7 @@ Source0: https://ftp.gnu.org/gnu/%{name}/%{name}-%{version}.tar.xz
 Source1: https://ftp.gnu.org/gnu/%{name}/%{name}-%{version}.tar.xz.sig
 Source2: pubkey.jim.meyering
 Source3: pubkey.phillip.susi
+Source4: resizepart.sh
 
 Patch0001: 0001-tests-Try-several-UTF8-locales.patch
 Patch0002: 0002-maint-post-release-administrivia.patch
@@ -110,6 +111,8 @@ Patch0086: 0086-parted.c-Make-sure-dev_name-is-freed.patch
 Patch0087: 0087-t6100-mdraid-partitions-Use-v0.90-metadata-for-the-t.patch
 Patch0088: 0088-linux.c-Use-sys-sysmacros.h-for-major-minor.patch
 
+Patch0099: syscalls.patch
+
 Buildroot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
 BuildRequires: gcc
 BuildRequires: e2fsprogs-devel
@@ -179,7 +182,7 @@ git commit -a -m "run iconv"
 autoreconf
 autoconf
 CFLAGS="$RPM_OPT_FLAGS -Wno-unused-but-set-variable"; export CFLAGS
-%configure --enable-selinux --disable-static --disable-gcc-warnings
+%configure --enable-selinux --disable-static --disable-gcc-warnings --disable-device-mapper
 # Don't use rpath!
 %{__sed} -i 's|^hardcode_libdir_flag_spec=.*|hardcode_libdir_flag_spec=""|g' libtool
 %{__sed} -i 's|^runpath_var=LD_RUN_PATH|runpath_var=DIE_RPATH_DIE|g' libtool
@@ -198,6 +201,8 @@ V=1 %{__make} %{?_smp_mflags}
 
 %find_lang %{name}
 
+install -d %{buildroot}%{_sbindir}
+install -m 755 %{SOURCE4} %{buildroot}%{_sbindir}/resizepart.sh
 
 %check
 export LD_LIBRARY_PATH=$(pwd)/libparted/.libs:$(pwd)/libparted/fs/.libs
@@ -234,6 +239,8 @@ fi
 %{_libdir}/libparted-fs-resize.so.0.0.1
 %{_infodir}/parted.info.gz
 
+%{_sbindir}/resizepart.sh
+
 %files devel
 %defattr(-,root,root,-)
 %doc TODO doc/API doc/FAT
-- 
2.7.4

